# Contributing

## Step by Step

1. Clone this repository
2. Make sure the versions for terraform and terraform docs are accordingly set for your module in the `Makefile`. It will be used
   in the CI pipeline
3. Start writing terraform code and make sure to use [Conventional Commits](https://www.conventionalcommits.org/), the
   Release will be created based on the git history along with the changelog file, if commits messages are not properly
   formed, the release won't be triggered and changes will be skipped.
4. Include tests whenever possible and make sure the previous ones are still valid after your changes
5. Open a PR and poke the CODEOWNERS for reviews

## Documentation

Documentation for the module will be auto generated by [terraform-docs](https://github.com/terraform-docs/terraform-docs) 
whenever a commit is pushed to any branch different from the release or main branches.

THe auto generated files rely on the `description` fields for inputs and outputs created in the module, some other sections
like requirements use the `requeriments` block from the versions.tf file to extract the information. Resources and data
sources sections are generated from all the terraform files found in this repo root.

You can change or adjust the content of the documentation using the [.terraform-docs.yml](https://github.com/terraform-docs/terraform-docs/blob/master/docs/user-guide/configuration.md)
file. For including more sections, take a look at the key `content` key in the same file. 

Extra documentation goes under the `docs` folder and then included as part of the `content` key in the `.terraform-docs.yml`
file.
```yaml
content: |-
    {{ .Header }}

    {{ .Requirements }}

    {{ include "docs/compatibility.md" }}

    {{ .Providers }}

    {{ .Modules }}

    {{ .Resources }}

    {{ .Inputs }}

    {{ .Outputs }}

    {{ include "docs/features.md" }}

    ## Examples
    This is example can be found in the `examples` folder from this repo

    ```hcl
    {{ include "examples/main.tf" }}
    ```

    {{ include "docs/references.md" }}
    
    {{ include "docs/my-new-doc" }}

```

## Release

Any time a PR is merged to the main branch a GitHub action runs to create a new PR release. We use the [release-please](https://github.com/google-github-actions/release-please-action)
action to create a PR with the next sequential version accordingly to the commits pushed more recently to the main branch.

For defining if the next version would increment the patch, minor or major version, `release-please` assumes you are using
[Conventional Commits Messages](https://github.com/googleapis/release-please#how-should-i-write-my-commits). This way,
it can generate the changelog file and a proper description for the release pr.

The most common prefixes for the git commit messages are:
``` markdown
fix: which represents bug fixes, and correlates to a SemVer patch.
feat: which represents a new feature, and correlates to a SemVer minor.
feat!:, or fix!:, refactor!:, etc., which represent a breaking change (indicated by the !) and will result in a SemVer major.
```
